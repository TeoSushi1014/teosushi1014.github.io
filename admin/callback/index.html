<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Authentication Callback</title>
</head>
<body>
  <script>
    // Function to handle the OAuth callback
    async function handleCallback() {
      try {
        const code = new URLSearchParams(window.location.search).get('code');
        
        if (code) {
          // Get the token using the code
          const tokenResponse = await fetch('https://github.com/login/oauth/access_token', {
            method: 'POST',
            headers: {
              'Accept': 'application/json',
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              client_id: 'Ov23liSyMU0un5r2RpN4',
              client_secret: 'cefd504eef04a853ec43bad84659e643306b2acb',
              code: code
            })
          });

          const data = await tokenResponse.json();
          
          if (data.access_token) {
            // Send the token back to the CMS
            if (window.opener) {
              window.opener.postMessage(
                {
                  type: 'oauth',
                  provider: 'github',
                  token: data.access_token
                },
                window.location.origin
              );
            }
          }
        }
      } catch (error) {
        console.error('Auth callback error:', error);
      } finally {
        // Close the popup window
        window.close();
      }
    }

    // Run the handler when the page loads
    handleCallback();
  </script>
</body>
</html>