<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Authentication Callback</title>
</head>
<body>
  <script>
    try {
      // Handle both hash and search parameters
      const params = {};
      const hash = window.location.hash.substring(1);
      const search = window.location.search.substring(1);
      
      // Parse hash parameters
      if (hash) {
        hash.split('&').forEach(pair => {
          const [key, value] = pair.split('=');
          params[key] = decodeURIComponent(value);
        });
      }
      
      // Parse search parameters
      if (search) {
        search.split('&').forEach(pair => {
          const [key, value] = pair.split('=');
          params[key] = decodeURIComponent(value);
        });
      }

      // If we have a token, send it back to the CMS
      if (params.access_token || params.token) {
        const token = params.access_token || params.token;
        if (window.opener) {
          window.opener.postMessage(
            {
              type: 'oauth',
              provider: 'github',
              token: token,
              ...params
            },
            window.location.origin
          );
          window.close();
        }
      }
    } catch (error) {
      console.error('Auth callback error:', error);
    }
  </script>
</body>
</html>